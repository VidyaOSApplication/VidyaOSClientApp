import{a as w}from"./chunk-HGUJNCJE.js";import{a as W}from"./chunk-FNKDIBDA.js";import{A as j,B as _,C as p,Da as V,Ea as k,F as d,G as T,Ga as O,H as y,J as f,K as I,L as S,Ma as B,Oa as N,R as A,S as P,Ta as L,U as E,Va as H,Wa as D,X as F,Xa as U,Za as G,_a as J,ab as q,db as z,gb as K,hb as Q,kb as R,l as u,lb as X,m as h,mb as Y,pb as Z,qb as $,r as a,s as C,t as x,u as g,w as c,wb as ee,x as r,xb as te,y as l,z as M}from"./chunk-ASIUTVEG.js";import"./chunk-MYMNFIR5.js";import"./chunk-QUJFQN2Y.js";import"./chunk-SQ2FC6MI.js";import"./chunk-MXQU5NIL.js";import"./chunk-RE5BQNDC.js";import"./chunk-WMOWL56E.js";import"./chunk-VZPOKD32.js";import"./chunk-DE3NY5IG.js";import"./chunk-GVUKRWTT.js";import"./chunk-7FY2OE2O.js";import"./chunk-V5RQBZ6Q.js";import"./chunk-TOLZJHI4.js";import"./chunk-3IV7M6SB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-O6KNH33T.js";import"./chunk-CKP3SGE2.js";import"./chunk-IMAI2IPK.js";import"./chunk-PAKTAAC6.js";import"./chunk-BBW5KUYG.js";import"./chunk-677QIFDF.js";import"./chunk-G7CBOZIR.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-3IVKBF6N.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as m}from"./chunk-JHI3MBHO.js";function ie(i,o){if(i&1&&(r(0,"ion-select-option",8),d(1),l()),i&2){let s=o.$implicit;c("value",s),a(),y(" Class ",s," ")}}function se(i,o){if(i&1&&(r(0,"ion-select-option",8),d(1),l()),i&2){let s=o.$implicit;c("value",s.id),a(),y(" ",s.name," ")}}function ne(i,o){if(i&1){let s=j();r(0,"ion-item")(1,"ion-label",2),d(2,"Stream *"),l(),r(3,"ion-select",9),S("ngModelChange",function(t){u(s);let e=p();return I(e.streamId,t)||(e.streamId=t),h(t)}),_("ionChange",function(){u(s);let t=p();return h(t.loadSubjects())}),g(4,se,2,2,"ion-select-option",4),l()()}if(i&2){let s=p();a(3),f("ngModel",s.streamId),a(),c("ngForOf",s.streams)}}function oe(i,o){if(i&1){let s=j();r(0,"ion-item")(1,"ion-checkbox",11),S("ngModelChange",function(t){let e=u(s).$implicit;return I(e.selected,t)||(e.selected=t),h(t)}),l(),r(2,"ion-label"),d(3),l()()}if(i&2){let s=o.$implicit;a(),f("ngModel",s.selected),a(2),T(s.subjectName)}}function ae(i,o){if(i&1&&(r(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3,"Select Subjects"),l()(),r(4,"ion-card-content"),g(5,oe,4,2,"ion-item",10),l()()),i&2){let s=p();a(5),c("ngForOf",s.subjects)}}function re(i,o){i&1&&M(0,"ion-spinner",12)}var Ie=(()=>{let o=class o{constructor(n,t){this.http=n,this.toast=t,this.classes=[],this.showStream=!1,this.streamId=null,this.streams=[{id:1,name:"PCM"},{id:2,name:"PCB"},{id:3,name:"Commerce"},{id:4,name:"Arts"}],this.subjects=[],this.saving=!1}ngOnInit(){return m(this,null,function*(){this.classes=Array.from({length:12},(t,e)=>e+1);let n=yield W.get({key:"user_profile"});this.schoolId=JSON.parse(n.value).schoolId})}onClassChange(){this.subjects=[],this.streamId=null,this.showStream=this.classId===11||this.classId===12,this.showStream||this.loadSubjects()}loadSubjects(){if(!this.classId||this.showStream&&!this.streamId)return;let n={schoolId:this.schoolId,classId:this.classId};this.showStream&&this.streamId&&(n.streamId=this.streamId),this.http.get(`${w.apiBaseUrl}/School/GetSubjectsForAssignment`,{params:n}).subscribe(t=>{this.subjects=(t.data||[]).map(e=>({subjectId:e.subjectId,subjectName:e.subjectName,selected:e.assigned}))})}save(){return m(this,null,function*(){let n=this.subjects.filter(e=>e.selected).map(e=>e.subjectId);if(!n.length){this.showToast("Select at least one subject","danger");return}this.saving=!0;let t={schoolId:this.schoolId,classId:this.classId,subjectIds:n};this.showStream&&(t.streamId=this.streamId),this.http.post(`${w.apiBaseUrl}/School/AssignClassSubjects`,t).subscribe({next:()=>m(this,null,function*(){this.saving=!1,this.showToast("Subjects assigned successfully","success")}),error:()=>m(this,null,function*(){this.saving=!1,this.showToast("Failed to assign subjects","danger")})})})}showToast(n,t){return m(this,null,function*(){yield(yield this.toast.create({message:n,duration:2e3,position:"top",color:t})).present()})}};o.\u0275fac=function(t){return new(t||o)(C(F),C(ee))},o.\u0275cmp=x({type:o,selectors:[["app-assign-class-subjects"]],decls:15,vars:6,consts:[["color","primary"],[1,"ion-padding"],["position","stacked"],["placeholder","Select class",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["expand","block","color","success",1,"ion-margin-top",3,"click","disabled"],["slot","start",4,"ngIf"],[3,"value"],["placeholder","Select stream",3,"ngModelChange","ionChange","ngModel"],[4,"ngFor","ngForOf"],["slot","start",3,"ngModelChange","ngModel"],["slot","start"]],template:function(t,e){t&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),d(3,"Assign Subjects"),l()()(),r(4,"ion-content",1)(5,"ion-item")(6,"ion-label",2),d(7,"Class *"),l(),r(8,"ion-select",3),S("ngModelChange",function(b){return I(e.classId,b)||(e.classId=b),b}),_("ionChange",function(){return e.onClassChange()}),g(9,ie,2,2,"ion-select-option",4),l()(),g(10,ne,5,2,"ion-item",5)(11,ae,6,1,"ion-card",5),r(12,"ion-button",6),_("click",function(){return e.save()}),g(13,re,1,0,"ion-spinner",7),d(14," Save Subjects "),l()()),t&2&&(a(8),f("ngModel",e.classId),a(),c("ngForOf",e.classes),a(),c("ngIf",e.showStream),a(),c("ngIf",e.subjects.length),a(),c("disabled",e.saving||!e.subjects.length),a(),c("ngIf",e.saving))},dependencies:[te,L,H,D,U,G,J,q,z,K,Q,R,X,Y,Z,$,B,N,E,A,P,O,V,k],encapsulation:2});let i=o;return i})();export{Ie as AssignClassSubjectsPage};
