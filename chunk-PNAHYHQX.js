import{a as y}from"./chunk-HGUJNCJE.js";import{a as k}from"./chunk-FNKDIBDA.js";import{A,B as u,C as _,F as o,G as g,H as L,I as b,O as I,P as x,R as S,S as D,T as M,Ta as E,U as T,Va as $,Wa as j,X as O,Xa as F,Ya as U,Za as B,ab as R,db as V,l as f,m as h,mb as N,pb as z,qb as H,r as c,s as p,t as C,tb as q,u as P,w as m,wb as G,x as a,xb as J,y as n,z as w}from"./chunk-ASIUTVEG.js";import"./chunk-MYMNFIR5.js";import"./chunk-QUJFQN2Y.js";import"./chunk-SQ2FC6MI.js";import"./chunk-MXQU5NIL.js";import"./chunk-RE5BQNDC.js";import"./chunk-WMOWL56E.js";import"./chunk-VZPOKD32.js";import"./chunk-DE3NY5IG.js";import"./chunk-GVUKRWTT.js";import"./chunk-7FY2OE2O.js";import"./chunk-V5RQBZ6Q.js";import"./chunk-TOLZJHI4.js";import"./chunk-3IV7M6SB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-O6KNH33T.js";import"./chunk-CKP3SGE2.js";import"./chunk-IMAI2IPK.js";import"./chunk-PAKTAAC6.js";import"./chunk-BBW5KUYG.js";import"./chunk-677QIFDF.js";import"./chunk-G7CBOZIR.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-3IVKBF6N.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as d}from"./chunk-JHI3MBHO.js";function K(r,s){r&1&&w(0,"ion-spinner",5)}function Q(r,s){if(r&1){let l=A();a(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3),n(),a(4,"ion-card-subtitle"),o(5),n()(),a(6,"ion-card-content")(7,"p")(8,"strong"),o(9),I(10,"date"),n(),o(11," \u2192 "),a(12,"strong"),o(13),I(14,"date"),n()(),a(15,"p")(16,"strong"),o(17,"Reason:"),n(),o(18),n(),a(19,"div",6)(20,"ion-button",7),u("click",function(){let e=f(l).$implicit,i=_();return h(i.takeAction(e,"Approved"))}),o(21," Approve "),n(),a(22,"ion-button",8),u("click",function(){let e=f(l).$implicit,i=_();return h(i.takeAction(e,"Rejected"))}),o(23," Reject "),n()()()()}if(r&2){let l=s.$implicit;c(3),g(l.name),c(2),b(" ",l.role," | ",l.appliedOn," "),c(4),g(x(10,6,l.fromDate,"dd-MM-yyyy")),c(4),g(x(14,9,l.toDate,"dd-MM-yyyy")),c(5),L(" ",l.reason)}}function W(r,s){r&1&&(a(0,"div",9),o(1," \u{1F389} No pending leave requests "),n())}var re=(()=>{let s=class s{constructor(t,e,i){this.http=t,this.alertCtrl=e,this.toastCtrl=i,this.loading=!1,this.leaves=[],this.schoolId=0,this.adminUserId=0}ngOnInit(){return d(this,null,function*(){let t=yield k.get({key:"user_profile"});if(t.value){let e=JSON.parse(t.value);this.adminUserId=e.userId,this.schoolId=e.schoolId}this.loadPendingLeaves()})}loadPendingLeaves(){this.loading=!0,this.http.get(`${y.apiBaseUrl}/School/GetPendingLeaves?schoolId=${this.schoolId}`).subscribe({next:t=>{this.leaves=t.data||[],this.loading=!1},error:()=>{this.loading=!1,this.showToast("Failed to load pending leaves","danger")}})}takeAction(t,e){return d(this,null,function*(){let i=new Date(t.fromDate).toLocaleDateString(),v=new Date(t.toDate).toLocaleDateString();yield(yield this.alertCtrl.create({header:e==="Approved"?"Approve Leave?":"Reject Leave?",message:`
        ${t.name}
        ${i} \u2192 ${v}
        Are you sure you want to ${e.toLowerCase()}
      `,buttons:[{text:"Cancel",role:"cancel"},{text:e==="Approved"?"Approve":"Reject",role:"confirm",handler:()=>this.confirmLeaveAction(t,e)}]})).present()})}confirmLeaveAction(t,e){let i={leaveId:t.leaveId,adminUserId:this.adminUserId,action:e};this.http.post(`${y.apiBaseUrl}/School/TakeLeaveAction`,i).subscribe({next:()=>{this.showToast(`Leave ${e.toLowerCase()} successfully`,"success"),this.leaves=this.leaves.filter(v=>v.leaveId!==t.leaveId)},error:()=>{this.showToast("Failed to update leave status","danger")}})}showToast(t,e){return d(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2e3,position:"top",color:e})).present()})}};s.\u0275fac=function(e){return new(e||s)(p(O),p(q),p(G))},s.\u0275cmp=C({type:s,selectors:[["app-admin-pending-leaves"]],decls:8,vars:3,consts:[["color","primary"],[1,"ion-padding"],["class","ion-margin",4,"ngIf"],[4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"ion-margin"],[1,"action-row"],["color","success","size","small",3,"click"],["color","danger","size","small",3,"click"],[1,"empty-state"]],template:function(e,i){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),o(3,"Pending Leaves"),n()()(),a(4,"ion-content",1),P(5,K,1,0,"ion-spinner",2)(6,Q,24,12,"ion-card",3)(7,W,2,0,"div",4),n()),e&2&&(c(5),m("ngIf",i.loading),c(),m("ngForOf",i.leaves),c(),m("ngIf",!i.loading&&i.leaves.length===0))},dependencies:[T,S,D,J,E,$,j,F,U,B,R,V,N,z,H,M],styles:[".center-spinner[_ngcontent-%COMP%]{display:block;margin:40px auto}.leave-card[_ngcontent-%COMP%]{margin-bottom:16px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:12px}.empty-state[_ngcontent-%COMP%]{text-align:center;margin-top:60px;color:#6b7280}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:10px}.name[_ngcontent-%COMP%]{color:#000}"]});let r=s;return r})();export{re as AdminPendingLeavesPage};
