import{a as w}from"./chunk-HGUJNCJE.js";import{a as A}from"./chunk-FNKDIBDA.js";import{A as f,Ab as X,Bb as Y,C as d,D as l,E as i,Eb as Z,F as h,Fb as ee,Hb as te,I as _,J as x,K as p,Kb as ne,Lb as ie,Q as O,Ra as z,S as c,Sa as L,T as P,U as C,Ua as W,V as k,W as M,X as I,Y as y,ab as j,ba as E,cb as $,ea as T,fa as V,gb as D,ha as N,ka as B,m as g,n as u,nb as U,pb as H,qb as R,sb as G,tb as J,u as a,vb as K,w as S,wb as q,y as F,zb as Q}from"./chunk-A35WYOVZ.js";import"./chunk-MYMNFIR5.js";import"./chunk-QUJFQN2Y.js";import"./chunk-SQ2FC6MI.js";import"./chunk-MXQU5NIL.js";import"./chunk-RE5BQNDC.js";import"./chunk-WMOWL56E.js";import"./chunk-VZPOKD32.js";import"./chunk-DE3NY5IG.js";import"./chunk-GVUKRWTT.js";import"./chunk-7FY2OE2O.js";import"./chunk-V5RQBZ6Q.js";import"./chunk-TOLZJHI4.js";import"./chunk-3IV7M6SB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-O6KNH33T.js";import"./chunk-CKP3SGE2.js";import"./chunk-IMAI2IPK.js";import"./chunk-IGVXFY24.js";import"./chunk-5TIAO6TV.js";import"./chunk-BANGDX2W.js";import"./chunk-FZQDFHAZ.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as v}from"./chunk-JHI3MBHO.js";function oe(n,r){if(n&1&&(l(0,"ion-select-option",14),c(1),i()),n&2){let e=r.$implicit;d("value",e),a(),C(" Class ",e," ")}}function se(n,r){if(n&1&&(l(0,"ion-select-option",14),c(1),i()),n&2){let e=r.$implicit;d("value",e.id),a(),C(" ",e.name," ")}}function le(n,r){if(n&1){let e=_();l(0,"div",18)(1,"div",19)(2,"div",20),c(3),i(),l(4,"div",21),c(5),i()(),l(6,"ion-button",22),x("click",function(){let s=g(e).$implicit,o=p(3);return u(o.loadFees(s))}),c(7," Select "),i()()}if(n&2){let e=r.$implicit;a(3),P(e.fullName),a(2),k(" Roll ",e.rollNo," \u2022 ",e.admissionNo," ")}}function ae(n,r){if(n&1&&(l(0,"div"),f(1,le,8,3,"div",17),i()),n&2){let e=p(2);a(),d("ngForOf",e.students)}}function ce(n,r){n&1&&(l(0,"p",23),c(1,"No students found"),i())}function re(n,r){if(n&1&&(l(0,"div",3)(1,"h3",4),h(2,"ion-icon",15),c(3," Students "),i(),f(4,ae,2,1,"div",16)(5,ce,2,0,"ng-template",null,0,E),i()),n&2){let e=O(6),t=p();a(4),d("ngIf",t.students.length)("ngIfElse",e)}}function de(n,r){if(n&1){let e=_();l(0,"div",24)(1,"h3",4),h(2,"ion-icon",25),c(3," Selected Student "),i(),l(4,"div",26)(5,"div")(6,"strong"),c(7),i(),l(8,"p"),c(9),i()(),l(10,"ion-button",27),x("click",function(){g(e);let s=p();return u(s.changeStudent())}),c(11," Change "),i()()()}if(n&2){let e=p();a(7),P(e.selectedStudent.fullName),a(2),k(" Roll ",e.selectedStudent.rollNo," \u2022 ",e.selectedStudent.admissionNo," ")}}function pe(n,r){n&1&&(l(0,"span",40),c(1," Paid "),i())}function fe(n,r){if(n&1){let e=_();l(0,"div",34)(1,"ion-checkbox",35),x("ionChange",function(s){let o=g(e).$implicit,b=p(2);return u(b.toggleMonth(o.feeMonth,s.detail.checked))}),i(),l(2,"div",36)(3,"div",37),c(4),i(),l(5,"div",38),c(6),i()(),f(7,pe,2,0,"span",39),i()}if(n&2){let e=r.$implicit,t=p(2);a(),d("checked",e.status==="Paid"||t.selectedMonths.includes(e.feeMonth))("disabled",e.status==="Paid"),a(3),C(" ",t.formatMonth(e.feeMonth)," "),a(2),C(" \u20B9",e.amount," "),a(),d("ngIf",e.status==="Paid")}}function me(n,r){if(n&1){let e=_();l(0,"div",3)(1,"h3",4),h(2,"ion-icon",28),c(3," Pending Fees "),i(),f(4,fe,8,5,"div",29),l(5,"div",30)(6,"span"),c(7,"Total"),i(),l(8,"strong"),c(9),i()(),l(10,"ion-item")(11,"ion-label",6),c(12,"Payment Mode"),i(),l(13,"ion-select",31),y("ngModelChange",function(s){g(e);let o=p();return I(o.paymentMode,s)||(o.paymentMode=s),u(s)}),l(14,"ion-select-option",32),c(15,"Cash"),i(),l(16,"ion-select-option",33),c(17,"Online"),i()()()()}if(n&2){let e=p();a(4),d("ngForOf",e.fees),a(5),C("\u20B9",e.totalAmount),a(4),M("ngModel",e.paymentMode)}}function ge(n,r){n&1&&h(0,"ion-spinner",44)}function ue(n,r){if(n&1){let e=_();l(0,"ion-footer",41)(1,"ion-button",42),x("click",function(){g(e);let s=p();return u(s.collectFee())}),f(2,ge,1,0,"ion-spinner",43),c(3," Collect Fee "),i()()}if(n&2){let e=p();a(),d("disabled",e.saving),a(),d("ngIf",e.saving)}}var we=(()=>{let r=class r{constructor(t,s,o){this.http=t,this.toastCtrl=s,this.alertCtrl=o,this.loading=!1,this.saving=!1,this.schoolId=0,this.classes=[],this.sections=[{id:1,name:"A"},{id:2,name:"B"},{id:3,name:"C"}],this.classId=null,this.sectionId=null,this.students=[],this.selectedStudent=null,this.showStudentList=!1,this.fees=[],this.selectedMonths=[],this.paymentMode="Cash"}ngOnInit(){return v(this,null,function*(){this.classes=Array.from({length:12},(s,o)=>o+1);let t=yield A.get({key:"user_profile"});t.value&&(this.schoolId=JSON.parse(t.value).schoolId)})}loadStudents(){this.students=[],this.selectedStudent=null,this.fees=[],this.selectedMonths=[],this.showStudentList=!0,!(!this.classId||!this.sectionId)&&this.http.get(`${w.apiBaseUrl}/School/GetStudentsByClassSection`,{params:{schoolId:this.schoolId,classId:this.classId,sectionId:this.sectionId}}).subscribe({next:t=>{this.students=t.data||[]},error:()=>{this.showToast("Failed to load students","danger")}})}loadFees(t){this.selectedStudent=t,this.showStudentList=!1,this.fees=[],this.selectedMonths=[],this.loading=!0,this.http.get(`${w.apiBaseUrl}/School/GetStudentFeeHistory?studentId=${t.studentId}`).subscribe({next:s=>{this.fees=s.data||[],this.loading=!1},error:()=>{this.loading=!1,this.showToast("Failed to load fees","danger")}})}changeStudent(){this.selectedStudent=null,this.fees=[],this.selectedMonths=[],this.showStudentList=!0}toggleMonth(t,s){s?this.selectedMonths.includes(t)||this.selectedMonths.push(t):this.selectedMonths=this.selectedMonths.filter(o=>o!==t)}get totalAmount(){return this.fees.filter(t=>this.selectedMonths.includes(t.feeMonth)).reduce((t,s)=>t+s.amount,0)}collectFee(){if(!this.selectedStudent||this.selectedMonths.length===0){this.showToast("Select at least one pending month","danger");return}this.saving=!0;let t={schoolId:this.schoolId,studentId:this.selectedStudent.studentId,feeMonths:this.selectedMonths,paymentMode:this.paymentMode};this.http.post(`${w.apiBaseUrl}/School/CollectFees`,t).subscribe({next:s=>v(this,null,function*(){this.saving=!1,yield this.showSuccess(s.data),this.loadFees(this.selectedStudent)}),error:()=>{this.saving=!1,this.showToast("Failed to collect fee","danger")}})}showSuccess(t){return v(this,null,function*(){yield(yield this.alertCtrl.create({header:"\u{1F4B0} Fee Collected",backdropDismiss:!1,message:`
        ${t.receiptNo}
        ${t.paidMonths.join(", ")}
        ${t.totalAmount}
        Payment successful
      `,buttons:["OK"]})).present()})}formatMonth(t){let[s,o]=t.split("-").map(Number);return new Date(s,o-1).toLocaleString("en-US",{month:"long",year:"numeric"})}showToast(t,s){return v(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2e3,position:"top",color:s})).present()})}};r.\u0275fac=function(s){return new(s||r)(S(B),S(ne),S(te))},r.\u0275cmp=F({type:r,selectors:[["app-collect-fee"]],decls:25,vars:9,consts:[["noStudents",""],[1,"fee-header"],[1,"fee-page"],[1,"section-card"],[1,"section-title"],["name","school-outline"],["position","stacked"],["placeholder","Select class",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Select section",3,"ngModelChange","ngModel"],["expand","block",1,"primary-btn",3,"click","disabled"],["class","section-card",4,"ngIf"],["class","section-card selected-student",4,"ngIf"],["class","fee-footer",4,"ngIf"],[3,"value"],["name","people-outline"],[4,"ngIf","ngIfElse"],["class","student-card",4,"ngFor","ngForOf"],[1,"student-card"],[1,"info"],[1,"name"],[1,"meta"],["size","small","color","success",3,"click"],[1,"empty-text"],[1,"section-card","selected-student"],["name","person-outline"],[1,"student-summary"],["fill","outline","size","small","color","medium",3,"click"],["name","wallet-outline"],["class","fee-row",4,"ngFor","ngForOf"],[1,"total-row"],[3,"ngModelChange","ngModel"],["value","Cash"],["value","Online"],[1,"fee-row"],[3,"ionChange","checked","disabled"],[1,"fee-info"],[1,"month"],[1,"amount"],["class","paid-badge",4,"ngIf"],[1,"paid-badge"],[1,"fee-footer"],["expand","block","color","success",3,"click","disabled"],["slot","start",4,"ngIf"],["slot","start"]],template:function(s,o){s&1&&(l(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),c(3,"Collect Fee"),i()()(),l(4,"ion-content",2)(5,"div",3)(6,"h3",4),h(7,"ion-icon",5),c(8," Select Class & Section "),i(),l(9,"ion-item")(10,"ion-label",6),c(11,"Class"),i(),l(12,"ion-select",7),y("ngModelChange",function(m){return I(o.classId,m)||(o.classId=m),m}),f(13,oe,2,2,"ion-select-option",8),i()(),l(14,"ion-item")(15,"ion-label",6),c(16,"Section"),i(),l(17,"ion-select",9),y("ngModelChange",function(m){return I(o.sectionId,m)||(o.sectionId=m),m}),f(18,se,2,2,"ion-select-option",8),i()(),l(19,"ion-button",10),x("click",function(){return o.loadStudents()}),c(20," Load Students "),i()(),f(21,re,7,2,"div",11)(22,de,12,3,"div",12)(23,me,18,3,"div",11),i(),f(24,ue,4,2,"ion-footer",13)),s&2&&(a(12),M("ngModel",o.classId),a(),d("ngForOf",o.classes),a(4),M("ngModel",o.sectionId),a(),d("ngForOf",o.sections),a(),d("disabled",!o.classId||!o.sectionId),a(2),d("ngIf",o.showStudentList),a(),d("ngIf",o.selectedStudent),a(),d("ngIf",o.selectedStudent&&o.fees.length),a(),d("ngIf",o.selectedStudent&&o.fees.length))},dependencies:[N,T,V,W,z,L,ie,D,U,H,R,G,J,K,q,Q,X,Y,Z,ee,j,$],styles:[".fee-page[_ngcontent-%COMP%]{--background: #f4f6fb;padding:16px}.fee-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #e0f2fe;--color: #075985;font-weight:700}.section-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;padding:16px;margin-bottom:18px;box-shadow:0 10px 25px #0000000f}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:600;margin-bottom:14px;color:#1f2937}.section-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}ion-item[_ngcontent-%COMP%]{--background: transparent;border:1px solid #e5e7eb;border-radius:12px;margin-bottom:12px}.primary-btn[_ngcontent-%COMP%]{height:48px;font-weight:600}.student-card[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:14px;background:#f9fafb;margin-bottom:10px}.student-card[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;color:#111827}.student-card[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-size:12.5px;color:#6b7280}.empty-text[_ngcontent-%COMP%]{text-align:center;color:#9ca3af;font-size:14px}.selected-student[_ngcontent-%COMP%]{background:#f0fdf4;border:1px solid #bbf7d0}.student-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.fee-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;background:#f9fafb;margin-bottom:8px}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px;margin-top:8px;border-top:1px dashed #e5e7eb;font-size:15px;font-weight:700}.fee-footer[_ngcontent-%COMP%]{padding:10px 14px;background:#fff;box-shadow:0 -6px 20px #00000014}.fee-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:50px;font-size:15px;font-weight:700;border-radius:14px}ion-checkbox[_ngcontent-%COMP%]{--size: 22px;--border-width: 2px;--border-radius: 6px;--border-color: #9ca3af;--background: #ffffff;--background-checked: #0ea5a4;--border-color-checked: #0ea5a4;--checkmark-color: #ffffff}ion-checkbox[disabled][_ngcontent-%COMP%]{--border-color: #d1d5db;--background: #f3f4f6;opacity:.9}.fee-row[_ngcontent-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{margin-top:2px}.fee-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.paid-badge[_ngcontent-%COMP%]{margin-left:auto;background:#dcfce7;color:#166534;font-size:12px;font-weight:700;padding:4px 10px;border-radius:999px;border:1px solid #bbf7d0}ion-checkbox[_ngcontent-%COMP%]{--size: 22px;--border-width: 2px;--border-radius: 6px;--border-color: #9ca3af;--background: #ffffff;--background-checked: #16a34a;--border-color-checked: #16a34a;--checkmark-color: #ffffff}ion-checkbox[disabled][_ngcontent-%COMP%]{opacity:1}.fee-info[_ngcontent-%COMP%]   .month[_ngcontent-%COMP%]{font-weight:600;color:#111827}.fee-info[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-size:12.5px;color:#6b7280}"]});let n=r;return n})();export{we as CollectFeePage};
