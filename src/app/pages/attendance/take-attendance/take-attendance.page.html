<ion-header class="attendance-header">
  <ion-toolbar>
    <ion-title>Take Attendance</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="attendance-page">

  <!-- FILTER CARD -->
  <div class="filter-card">

    <h3 class="section-title">
      <ion-icon name="school-outline"></ion-icon>
      Select Class & Section
    </h3>

    <ion-item>
      <ion-label position="stacked">Class</ion-label>
      <ion-select interface="popover"
                  placeholder="Select Class"
                  [(ngModel)]="classId">
        <ion-select-option *ngFor="let cls of classes" [value]="cls">
          Class {{ cls }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Section</ion-label>
      <ion-select interface="popover"
                  placeholder="Select Section"
                  [(ngModel)]="sectionId">
        <ion-select-option [value]="1">A</ion-select-option>
        <ion-select-option [value]="2">B</ion-select-option>
        <ion-select-option [value]="3">C</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-button expand="block"
                class="load-btn"
                (click)="takeAttendance()"
                [disabled]="!classId || !sectionId">
      Load Students
    </ion-button>

  </div>

  <!-- LOADER -->
  <div class="loader" *ngIf="loading">
    <ion-spinner></ion-spinner>
    <p>Loading students...</p>
  </div>

  <!-- STUDENT LIST -->
  <div class="students-list" *ngIf="students.length && !loading">

    <h3 class="section-title1">
      <ion-icon name="people-outline"></ion-icon>
      Mark Attendance
    </h3>

    <div class="student-card"
         *ngFor="let student of students; let i = index">

      <div class="left">
        <div class="avatar">{{ i + 1 }}</div>
        <div class="details">
          <div class="name">{{ student.fullName }}</div>
          <div class="admission">{{ student.admissionNo }}</div>
        </div>
      </div>

      <div class="right">

        <span class="leave-badge"
              *ngIf="!student.isEditable">
          On Leave
        </span>

        <ion-checkbox *ngIf="student.isEditable"
                      mode="md"
                      [checked]="student.status === 'Present'"
                      (ionChange)="onToggle(student, $event)">
        </ion-checkbox>

      </div>

    </div>

  </div>

  <!-- NO DATA -->
  <div class="no-data" *ngIf="hasSearched && !loading && students.length === 0">
    <ion-icon name="people-outline"></ion-icon>
    <p>No students found for selected class & section</p>
  </div>

</ion-content>

<!-- STICKY SAVE BUTTON -->
<ion-footer *ngIf="students.length && !loading" class="attendance-footer">
  <ion-button expand="block"
              color="success"
              (click)="saveAttendance()"
              [disabled]="saving">

    <ion-spinner *ngIf="saving" slot="start"></ion-spinner>
    Save Attendance

  </ion-button>
</ion-footer>
