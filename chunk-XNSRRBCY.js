import{a as ie,b as oe}from"./chunk-ZOOIGEF7.js";import"./chunk-HGUJNCJE.js";import"./chunk-FNKDIBDA.js";import{$a as H,A as v,B as C,C as m,Ca as z,Da as j,F as l,Fa as W,G as b,H as S,J as y,K as P,L as k,La as L,Na as D,R as A,S as E,Sa as N,U as F,W as B,X as V,Za as U,ab as $,cb as G,db as K,fb as R,g as O,gb as q,h as w,jb as J,kb as Q,l as x,lb as X,m as I,ob as Y,pb as Z,r as c,s as u,sb as ee,t as T,u as g,vb as te,w as d,wb as ne,x as a,y as r,z as _}from"./chunk-JP5JOBMG.js";import"./chunk-MYMNFIR5.js";import"./chunk-QUJFQN2Y.js";import"./chunk-SQ2FC6MI.js";import"./chunk-MXQU5NIL.js";import"./chunk-RE5BQNDC.js";import"./chunk-WMOWL56E.js";import"./chunk-VZPOKD32.js";import"./chunk-DE3NY5IG.js";import"./chunk-GVUKRWTT.js";import"./chunk-7FY2OE2O.js";import"./chunk-V5RQBZ6Q.js";import"./chunk-TOLZJHI4.js";import"./chunk-3IV7M6SB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-O6KNH33T.js";import"./chunk-CKP3SGE2.js";import"./chunk-IMAI2IPK.js";import"./chunk-PAKTAAC6.js";import"./chunk-BBW5KUYG.js";import"./chunk-677QIFDF.js";import"./chunk-G7CBOZIR.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-3IVKBF6N.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as h}from"./chunk-JHI3MBHO.js";var ae=(()=>{let i=class i{constructor(n){this.http=n,this.apiUrl=`${ie}/Teacher`}getStudents(n,o,e,f,p){let M=new B().set("schoolId",n).set("classId",o).set("sectionId",e).set("date",f);return p!=null&&(M=M.set("streamId",p.toString())),this.http.get(`${this.apiUrl}/GetStudents/students`,{params:M})}markAttendance(n){return this.http.post(`${this.apiUrl}/MarkAttendance/mark`,n)}};i.\u0275fac=function(o){return new(o||i)(w(V))},i.\u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();function ce(t,i){if(t&1&&(a(0,"ion-select-option",10),l(1),r()),t&2){let s=i.$implicit;d("value",s),c(),S(" Class ",s," ")}}function de(t,i){if(t&1&&(a(0,"ion-select-option",10),l(1),r()),t&2){let s=i.$implicit;d("value",s.id),c(),S(" ",s.name," ")}}function le(t,i){if(t&1){let s=v();a(0,"ion-item")(1,"ion-label",5),l(2,"Stream"),r(),a(3,"ion-select",16),k("ngModelChange",function(o){x(s);let e=m();return P(e.streamId,o)||(e.streamId=o),I(o)}),g(4,de,2,2,"ion-select-option",7),r()()}if(t&2){let s=m();c(3),y("ngModel",s.streamId),c(),d("ngForOf",s.streams)}}function pe(t,i){t&1&&(a(0,"div",17),_(1,"ion-spinner"),a(2,"p"),l(3,"Loading students..."),r()())}function ge(t,i){t&1&&(a(0,"span",31),l(1," On Leave "),r())}function me(t,i){if(t&1){let s=v();a(0,"ion-checkbox",32),C("ionChange",function(o){x(s);let e=m().$implicit,f=m(2);return I(f.onToggle(e,o))}),r()}if(t&2){let s=m().$implicit;d("checked",s.status==="Present")}}function fe(t,i){if(t&1&&(a(0,"div",22)(1,"div",23)(2,"div",24),l(3),r(),a(4,"div",25)(5,"div",26),l(6),r(),a(7,"div",27),l(8),r()()(),a(9,"div",28),g(10,ge,2,0,"span",29)(11,me,1,1,"ion-checkbox",30),r()()),t&2){let s=i.$implicit,n=i.index;c(3),b(n+1),c(3),b(s.fullName),c(2),b(s.admissionNo),c(2),d("ngIf",!s.isEditable),c(),d("ngIf",s.isEditable)}}function he(t,i){if(t&1&&(a(0,"div",18)(1,"h3",19),_(2,"ion-icon",20),l(3," Mark Attendance "),r(),g(4,fe,12,5,"div",21),r()),t&2){let s=m();c(4),d("ngForOf",s.students)}}function _e(t,i){t&1&&(a(0,"div",33),_(1,"ion-icon",20),a(2,"p"),l(3,"No students found for selected class & section"),r()())}function ue(t,i){t&1&&_(0,"ion-spinner",37)}function xe(t,i){if(t&1){let s=v();a(0,"ion-footer",34)(1,"ion-button",35),C("click",function(){x(s);let o=m();return I(o.saveAttendance())}),g(2,ue,1,0,"ion-spinner",36),l(3," Save Attendance "),r()()}if(t&2){let s=m();c(),d("disabled",s.saving),c(),d("ngIf",s.saving)}}var we=(()=>{let i=class i{constructor(n,o,e,f){this.attendanceService=n,this.authService=o,this.alertCtrl=e,this.toastCtrl=f,this.streamId=null,this.hasSearched=!1,this.loading=!1,this.saving=!1,this.classes=[],this.students=[],this.streams=[{id:1,name:"PCM"},{id:2,name:"PCB"},{id:3,name:"Commerce"},{id:4,name:"Arts"}]}ngOnInit(){return h(this,null,function*(){let n=yield this.authService.getStoredProfile();n&&(this.schoolId=n.schoolId,this.markedByUserId=n.userId),this.classes=Array.from({length:12},(o,e)=>e+1)})}onClassChange(){this.classId!==11&&this.classId!==12&&(this.streamId=null)}getTodayDate(){return new Date().toISOString().split("T")[0]}takeAttendance(){if(console.log(this.streamId),!(!this.classId||!this.sectionId)){if((this.classId===11||this.classId===12)&&!this.streamId){this.showToast("Please select stream","danger");return}this.loading=!0,this.hasSearched=!0,this.attendanceService.getStudents(this.schoolId,this.classId,this.sectionId,this.getTodayDate(),this.classId===11||this.classId===12?this.streamId:null).subscribe({next:n=>{this.students=n.students??[],console.log(this.students),this.loading=!1},error:()=>{this.students=[],this.loading=!1,this.showToast("Failed to load students","danger")}})}}saveAttendance(){if(!this.students.length)return;this.saving=!0;let n=this.students.filter(e=>e.isEditable).map(e=>({userId:e.userId,status:e.status})),o={schoolId:this.schoolId,classId:this.classId,sectionId:this.sectionId,attendanceDate:this.getTodayDate(),markedByUserId:this.markedByUserId,records:n};(this.classId===11||this.classId===12)&&(o.streamId=this.streamId),this.attendanceService.markAttendance(o).subscribe({next:()=>h(this,null,function*(){this.saving=!1,yield this.showToast("Attendance saved successfully","success")}),error:()=>h(this,null,function*(){this.saving=!1,yield this.showErrorAlert("Failed to save attendance. Please try again.")})})}onToggle(n,o){n.status=o.detail.checked?"Present":"Absent"}showToast(n,o){return h(this,null,function*(){yield(yield this.toastCtrl.create({message:n,duration:2e3,color:o,position:"bottom"})).present()})}showErrorAlert(n){return h(this,null,function*(){yield(yield this.alertCtrl.create({header:"Error",message:n,buttons:["OK"]})).present()})}};i.\u0275fac=function(o){return new(o||i)(u(ae),u(oe),u(ee),u(te))},i.\u0275cmp=T({type:i,selectors:[["app-take-attendance"]],decls:31,vars:12,consts:[[1,"attendance-header"],[1,"attendance-page"],[1,"filter-card"],[1,"section-title"],["name","school-outline"],["position","stacked"],["interface","popover","placeholder","Select Class",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["interface","popover","placeholder","Select Section",3,"ngModelChange","ngModel"],[3,"value"],["expand","block",1,"load-btn",3,"click","disabled"],["class","loader",4,"ngIf"],["class","students-list",4,"ngIf"],["class","no-data",4,"ngIf"],["class","attendance-footer",4,"ngIf"],["interface","popover","placeholder","Select Stream",3,"ngModelChange","ngModel"],[1,"loader"],[1,"students-list"],[1,"section-title1"],["name","people-outline"],["class","student-card",4,"ngFor","ngForOf"],[1,"student-card"],[1,"left"],[1,"avatar"],[1,"details"],[1,"name"],[1,"admission"],[1,"right"],["class","leave-badge",4,"ngIf"],["mode","md",3,"checked","ionChange",4,"ngIf"],[1,"leave-badge"],["mode","md",3,"ionChange","checked"],[1,"no-data"],[1,"attendance-footer"],["expand","block","color","success",3,"click","disabled"],["slot","start",4,"ngIf"],["slot","start"]],template:function(o,e){o&1&&(a(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),l(3,"Take Attendance"),r()()(),a(4,"ion-content",1)(5,"div",2)(6,"h3",3),_(7,"ion-icon",4),l(8," Select Class & Section "),r(),a(9,"ion-item")(10,"ion-label",5),l(11,"Class"),r(),a(12,"ion-select",6),k("ngModelChange",function(p){return P(e.classId,p)||(e.classId=p),p}),g(13,ce,2,2,"ion-select-option",7),r()(),g(14,le,5,2,"ion-item",8),a(15,"ion-item")(16,"ion-label",5),l(17,"Section"),r(),a(18,"ion-select",9),k("ngModelChange",function(p){return P(e.sectionId,p)||(e.sectionId=p),p}),a(19,"ion-select-option",10),l(20,"A"),r(),a(21,"ion-select-option",10),l(22,"B"),r(),a(23,"ion-select-option",10),l(24,"C"),r()()(),a(25,"ion-button",11),C("click",function(){return e.takeAttendance()}),l(26," Load Students "),r()(),g(27,pe,4,0,"div",12)(28,he,5,1,"div",13)(29,_e,4,0,"div",14),r(),g(30,xe,4,2,"ion-footer",15)),o&2&&(c(12),y("ngModel",e.classId),c(),d("ngForOf",e.classes),c(),d("ngIf",e.classId===11||e.classId===12),c(4),y("ngModel",e.sectionId),c(),d("value",1),c(2),d("value",2),c(2),d("value",3),c(2),d("disabled",!e.classId||!e.sectionId),c(2),d("ngIf",e.loading),c(),d("ngIf",e.students.length&&!e.loading),c(),d("ngIf",e.hasSearched&&!e.loading&&e.students.length===0),c(),d("ngIf",e.students.length&&!e.loading))},dependencies:[ne,N,U,H,$,G,K,R,q,J,Q,X,Y,Z,L,D,F,A,E,W,z,j],styles:[".attendance-page[_ngcontent-%COMP%]{--background: #f4f6fb;padding:14px}.attendance-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #e0f2fe;--color: #075985;font-weight:700}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:600;margin-bottom:12px;color:#1f2937}.section-title1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:600;margin-bottom:12px;margin-left:15px;color:#1f2937}.section-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.filter-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;padding:16px;box-shadow:0 10px 26px #0000000f;margin-bottom:16px}.filter-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;border:1px solid #e5e7eb;border-radius:12px;margin-bottom:12px}.load-btn[_ngcontent-%COMP%]{margin-top:4px;height:48px;font-weight:600}.loader[_ngcontent-%COMP%]{text-align:center;margin-top:24px;color:#6b7280}.loader[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:6px;font-size:14px}.students-list[_ngcontent-%COMP%]{margin-top:8px}.student-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:12px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 6px 18px #0000000d}.student-card[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.avatar[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:50%;background:#e0f2fe;color:#0369a1;font-size:14px;font-weight:600;display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:14.5px;font-weight:600;color:#111827}.details[_ngcontent-%COMP%]   .admission[_ngcontent-%COMP%]{font-size:12.5px;color:#6b7280}.student-card[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.leave-badge[_ngcontent-%COMP%]{font-size:12px;padding:4px 8px;background:#fef3c7;color:#92400e;border-radius:8px;font-weight:600}.no-data[_ngcontent-%COMP%]{margin-top:40px;text-align:center;color:#9ca3af}.no-data[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px;margin-bottom:8px}.attendance-footer[_ngcontent-%COMP%]{padding:10px 14px;background:#fff;box-shadow:0 -6px 20px #00000014}.attendance-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:50px;font-size:15px;font-weight:700;border-radius:14px}ion-item[_ngcontent-%COMP%]{--disabled-opacity: 1;opacity:1!important}ion-select[_ngcontent-%COMP%]{--color: #111827;--placeholder-color: #6b7280;--placeholder-opacity: 1;opacity:1!important}ion-select[_ngcontent-%COMP%]::part(text){color:#111827!important;opacity:1!important;font-weight:500}ion-item.item-has-value[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(text){color:#111827!important;opacity:1!important}ion-select[_ngcontent-%COMP%]::part(icon){color:#374151!important;opacity:1!important}ion-checkbox[_ngcontent-%COMP%]{--size: 22px;--border-width: 2px;--border-radius: 6px;--border-color: #9ca3af;--background: #ffffff;--checkmark-color: #ffffff;--background-checked: #0ea5a4;--border-color-checked: #0ea5a4}.student-card[_ngcontent-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{margin-left:6px}"]});let t=i;return t})();export{we as TakeAttendancePage};
